<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
</head>
<body>
    <button id="scanButton">Scan QR Code</button>
    <div id="videoContainer"></div>
    <script src="https://cdn.jsdelivr.net/npm/jsQR@1.0.0/dist/jsQR.js"></script>
    <script src="app.js"></script>

<script>
document.getElementById("scanButton").addEventListener("click", startCamera);

function startCamera() {
    // Access the user's camera
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(handleSuccess)
        .catch(handleError);
}

function handleSuccess(stream) {
    // Create a video element to display the camera stream
    var video = document.createElement("video");
    video.srcObject = stream;
    video.autoplay = true;

    // Append the video element to the video container
    var videoContainer = document.getElementById("videoContainer");
    videoContainer.appendChild(video);

    // Listen for frames from the camera
    video.addEventListener("loadeddata", function() {
        // Start scanning frames for QR codes
        setInterval(scanFrame, 100, video);
    });
}

function handleError(error) {
    console.error("Error accessing camera:", error);
}

function scanFrame(video) {
    // Create a canvas element to draw the video frame
    var canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    var ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Get the image data from the canvas
    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

    // Decode the QR code from the image data
    var code = jsQR(imageData.data, imageData.width, imageData.height);

    // If QR code is detected, stop scanning and display the result
    if (code) {
        alert("QR Code scanned: " + code.data);
        video.srcObject.getTracks().forEach(track => track.stop()); // Stop camera stream
    }
}


</script>
</body>
</html>